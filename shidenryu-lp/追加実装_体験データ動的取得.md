# è¿½åŠ å®Ÿè£…: ä½“é¨“ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‹ã‚‰å‹•çš„å–å¾—ã™ã‚‹

## æ¦‚è¦

ç¾åœ¨ `lib/services.ts` ã«ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã‚‹9ã¤ã®ä½“é¨“ãƒ‡ãƒ¼ã‚¿ã‚’ã€
Googleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®ã€Œä½“é¨“ãƒã‚¹ã‚¿ã€ã‚·ãƒ¼ãƒˆã‹ã‚‰å‹•çš„ã«å–å¾—ã™ã‚‹ä»•çµ„ã¿ã«å¤‰æ›´ã™ã‚‹ã€‚

**ã“ã‚Œã«ã‚ˆã‚Šï¼š**
- ä½“é¨“ã®åå‰ãƒ»èª¬æ˜ãƒ»ã‚¿ã‚°ç­‰ã‚’ã‚·ãƒ¼ãƒˆä¸Šã§ç·¨é›† â†’ ã‚³ãƒ¼ãƒ‰å¤‰æ›´ãªã—ã§æœ¬ç•ªåæ˜ 
- ä½“é¨“ã®è¿½åŠ ãƒ»éè¡¨ç¤ºã‚‚ã‚·ãƒ¼ãƒˆæ“ä½œã ã‘ã§å®Œçµ
- è¡¨ç¤ºé †ã‚‚ã‚·ãƒ¼ãƒˆã§è‡ªç”±ã«å¤‰æ›´å¯èƒ½

---

## å¤‰æ›´ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«

```
lib/services.ts          â† å‹å®šç¾©ã®ã¿æ®‹ã™ã€‚ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤
lib/fetch-services.ts    â˜… æ–°è¦: GASçµŒç”±ã§ä½“é¨“ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹é–¢æ•°
app/page.tsx             â† ã‚µãƒ¼ãƒãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§fetchã—ã¦propsã§æ¸¡ã™
components/ServiceGrid.tsx       â† propsã‹ã‚‰å—ã‘å–ã‚‹å½¢ã«å¤‰æ›´
components/ServiceDetailModal.tsx â† propsã‹ã‚‰å—ã‘å–ã‚‹å½¢ã«å¤‰æ›´
app/booking/page.tsx     â† äºˆç´„ãƒ•ã‚©ãƒ¼ãƒ ã®Step 3ã§ã‚‚å‹•çš„ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ã†
app/api/services/route.ts â˜… æ–°è¦: ä½“é¨“ãƒ‡ãƒ¼ã‚¿å–å¾—APIãƒ«ãƒ¼ãƒˆï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ä»˜ãï¼‰
```

---

## å®Ÿè£…æ‰‹é †

### Step 1: å‹å®šç¾©ã‚’æ•´ç†ã™ã‚‹

`lib/services.ts` ã‹ã‚‰å‹å®šç¾©ã ã‘æ®‹ã—ã€ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã®ãƒ‡ãƒ¼ã‚¿é…åˆ—ã‚’å‰Šé™¤ã™ã‚‹ã€‚

```typescript
// lib/services.ts

export type Service = {
  id: string;
  icon: string;
  name: string;         // è‹±èªè¡¨ç¤ºåï¼ˆã‚·ãƒ¼ãƒˆã®ã€Œè‹±èªåã€åˆ—ï¼‰
  nameJa: string;       // æ—¥æœ¬èªåï¼ˆã‚·ãƒ¼ãƒˆã®ã€Œæ—¥æœ¬èªåã€åˆ—ï¼‰
  description: string;  // è‹±èªèª¬æ˜æ–‡
  details: string[];    // ä½“é¨“å†…å®¹ãƒªã‚¹ãƒˆï¼ˆé…åˆ—ï¼‰
  tags: string[];       // ã‚¿ã‚°ï¼ˆé…åˆ—ï¼‰
  image: string;        // ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«åï¼ˆä¾‹: "tate.jpg"ï¼‰
  duration: number;     // æ‰€è¦æ™‚é–“ï¼ˆåˆ†ï¼‰
  order: number;        // è¡¨ç¤ºé †
};

// â˜… ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã® services é…åˆ—ã¯å‰Šé™¤ã™ã‚‹
// export const services: Service[] = [...] â† ã“ã‚Œã‚’æ¶ˆã™
```

### Step 2: å–å¾—é–¢æ•°ã‚’ä½œã‚‹

```typescript
// lib/fetch-services.ts

import { Service } from './services';

export async function fetchServices(): Promise<Service[]> {
  try {
    const url = `${process.env.GAS_WEBAPP_URL}?action=getServices`;
    const res = await fetch(url, {
      next: { revalidate: 3600 }, // 1æ™‚é–“ã‚­ãƒ£ãƒƒã‚·ãƒ¥
    });
    const data = await res.json();
    return data.services || [];
  } catch (error) {
    console.error('Failed to fetch services:', error);
    return getFallbackServices(); // GASéšœå®³æ™‚ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
  }
}

// GASã«ç¹‹ãŒã‚‰ãªã„å ´åˆã®æœ€ä½é™ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
function getFallbackServices(): Service[] {
  return [
    { id: 'tate', icon: 'âš”ï¸', name: 'Sword Fighting (Tate)', nameJa: 'æ®ºé™£', description: 'Experience staged sword fighting from Japanese period dramas.', details: ['Learn sword stances', 'Practice cutting forms', 'Choreographed duel'], tags: ['Most Popular', 'Beginner OK'], image: 'tate.jpg', duration: 20, order: 1 },
    { id: 'costume', icon: 'ğŸ¥‹', name: 'Samurai Costume', nameJa: 'ä¾ç€ä»˜ã‘', description: 'Dress in authentic samurai attire.', details: ['Kimono & hakama dressing', 'History of samurai attire'], tags: ['Photo-friendly'], image: 'costume.jpg', duration: 20, order: 2 },
    { id: 'photo', icon: 'ğŸ“¸', name: 'Photo Session', nameJa: 'è¨˜å¿µæ’®å½±', description: 'Professional photos in samurai gear.', details: ['Posing guidance', 'Multiple setups'], tags: ['SNS-worthy'], image: 'photo.jpg', duration: 20, order: 3 },
    { id: 'tea', icon: 'ğŸµ', name: 'Tea Ceremony', nameJa: 'èŒ¶é“', description: 'Traditional tea ceremony in your room.', details: ['Whisking matcha', 'Tea bowl etiquette'], tags: ['Zen'], image: 'tea.jpg', duration: 20, order: 4 },
    { id: 'calligraphy', icon: 'âœï¸', name: 'Calligraphy', nameJa: 'æ›¸é“', description: 'Write Japanese calligraphy with brush and ink.', details: ['Brush technique', 'Write your name'], tags: ['Souvenir'], image: 'calligraphy.jpg', duration: 20, order: 5 },
    { id: 'dance', icon: 'ğŸª­', name: 'Japanese Dance', nameJa: 'æ—¥æœ¬èˆè¸Š', description: 'Learn traditional Japanese dance basics.', details: ['Fan handling', 'Basic choreography'], tags: ['Elegant'], image: 'dance.jpg', duration: 20, order: 6 },
    { id: 'shuriken', icon: 'ğŸ¯', name: 'Shuriken Throw', nameJa: 'æ‰‹è£å‰£', description: 'Throw shuriken at targets.', details: ['Throwing form', 'Target challenge'], tags: ['Fun!', 'Kids OK'], image: 'shuriken.jpg', duration: 20, order: 7 },
    { id: 'meditation', icon: 'ğŸ§˜', name: 'Meditation', nameJa: 'ç‘æƒ³', description: 'Samurai-style meditation and breathing.', details: ['Breathing techniques', 'Guided meditation'], tags: ['Relaxing'], image: 'meditation.jpg', duration: 20, order: 8 },
    { id: 'origami', icon: 'ğŸ“œ', name: 'Origami', nameJa: 'æŠ˜ã‚Šç´™', description: 'Create paper art with samurai themes.', details: ['Folding techniques', 'Make a kabuto helmet'], tags: ['Souvenir', 'Kids OK'], image: 'origami.jpg', duration: 20, order: 9 },
  ];
}
```

### Step 3: LPãƒšãƒ¼ã‚¸ã§fetchã—ã¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«æ¸¡ã™

`app/page.tsx` ã¯Server Componentãªã®ã§ç›´æ¥fetchã§ãã‚‹ã€‚

```tsx
// app/page.tsx
import { fetchServices } from '@/lib/fetch-services';

export default async function Home() {
  const services = await fetchServices();

  return (
    <>
      <Header />
      <Hero />
      <About />
      <ServiceGrid services={services} />
      {/* ServiceDetailModal ã¯ ServiceGrid å†…ã§ç®¡ç† */}
      <SessionFlow />
      <Pricing />
      <AvailabilityCalendar />
      <Info />
      <FAQ />
      <CTASection />
      <Footer />
    </>
  );
}
```

### Step 4: ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’propså—ã‘å–ã‚Šã«å¤‰æ›´

```tsx
// components/ServiceGrid.tsx
// Before: import { services } from '@/lib/services';
// After:  propsã§å—ã‘å–ã‚‹

import { Service } from '@/lib/services';

type Props = {
  services: Service[];
};

export default function ServiceGrid({ services }: Props) {
  // æ—¢å­˜ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãƒ­ã‚¸ãƒƒã‚¯ã¯ãã®ã¾ã¾
  // services.map(...) ã§ä½“é¨“ã‚«ãƒ¼ãƒ‰ã‚’è¡¨ç¤º
}
```

```tsx
// components/ServiceDetailModal.tsx
import { Service } from '@/lib/services';

type Props = {
  service: Service | null;
  isOpen: boolean;
  onClose: () => void;
};

export default function ServiceDetailModal({ service, isOpen, onClose }: Props) {
  if (!service || !isOpen) return null;
  // service.name, service.description, service.details, service.tags ã‚’è¡¨ç¤º
  // service.image â†’ <Image src={`/images/${service.image}`} />
}
```

### Step 5: äºˆç´„ãƒ•ã‚©ãƒ¼ãƒ ã§ã‚‚å‹•çš„ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ã†

`/booking` ãƒšãƒ¼ã‚¸ã® Step 3ï¼ˆä½“é¨“é¸æŠï¼‰ã§ã‚‚åŒã˜ãƒ‡ãƒ¼ã‚¿ãŒå¿…è¦ã€‚
ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãªã®ã§ã€APIãƒ«ãƒ¼ãƒˆçµŒç”±ã§å–å¾—ã™ã‚‹ã€‚

```typescript
// app/api/services/route.ts â˜… æ–°è¦
import { fetchServices } from '@/lib/fetch-services';

export async function GET() {
  const services = await fetchServices();
  return Response.json({ services });
}
```

```tsx
// app/booking/page.tsx ã® Step 3 éƒ¨åˆ†
// ãƒã‚¦ãƒ³ãƒˆæ™‚ã«å–å¾—
useEffect(() => {
  fetch('/api/services')
    .then(r => r.json())
    .then(d => setServices(d.services));
}, []);
```

---

## GASå´ã®å¤‰æ›´

GASã® `doGet` é–¢æ•°ã« `getServices` ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ã™ã‚‹ã€‚
ã‚³ãƒ¼ãƒ‰ã¯ `å‰£èˆä¼šã‚¨ãƒƒã‚¸_ã‚·ãƒ¼ãƒˆè¨­è¨ˆ_final.xlsx` ã®ã€ŒGASé€£æºä»•æ§˜ã€ã‚·ãƒ¼ãƒˆã«è¨˜è¼‰æ¸ˆã¿ã€‚

**è¦ç‚¹ï¼š**
- ä½“é¨“ãƒã‚¹ã‚¿ã‚·ãƒ¼ãƒˆã‚’å…¨è¡Œèª­ã¿å–ã‚Š
- ã€Œæœ‰åŠ¹ã€åˆ—ãŒ TRUE ã®è¡Œã ã‘è¿”ã™
- ã€Œä½“é¨“å†…å®¹ã€åˆ—ã¯æ”¹è¡Œï¼ˆ`\n`ï¼‰ã§åˆ†å‰²ã—ã¦é…åˆ—ã«ã™ã‚‹
- ã€Œã‚¿ã‚°ã€åˆ—ã¯ã‚«ãƒ³ãƒã§åˆ†å‰²ã—ã¦é…åˆ—ã«ã™ã‚‹
- ã€Œè¡¨ç¤ºé †ã€åˆ—ã§æ˜‡é †ã‚½ãƒ¼ãƒˆã—ã¦è¿”ã™

---

## ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã€Œä½“é¨“ãƒã‚¹ã‚¿ã€ã‚·ãƒ¼ãƒˆã®åˆ—ï¼ˆæ›´æ–°æ¸ˆã¿ï¼‰

| åˆ— | å†…å®¹ | ç·¨é›† | LPåæ˜  |
|----|------|------|--------|
| id | ä¸€æ„ã®IDï¼ˆtate, teaç­‰ï¼‰ | âŒ å¤‰æ›´ä¸å¯ | å†…éƒ¨ã‚­ãƒ¼ |
| ã‚¢ã‚¤ã‚³ãƒ³ | çµµæ–‡å­— | âœ… | ã‚«ãƒ¼ãƒ‰è¡¨ç¤º |
| æ—¥æœ¬èªå | ç®¡ç†ç”¨æ—¥æœ¬èªå | âœ… | ç®¡ç†ç”¨ |
| è‹±èªå | LPä¸Šã®è¡¨ç¤ºå | âœ… | ã‚«ãƒ¼ãƒ‰ + ãƒ¢ãƒ¼ãƒ€ãƒ« |
| è‹±èªèª¬æ˜æ–‡ | è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ«ã®èª¬æ˜ | âœ… | ãƒ¢ãƒ¼ãƒ€ãƒ« |
| ä½“é¨“å†…å®¹ | æ”¹è¡ŒåŒºåˆ‡ã‚Šã®ãƒªã‚¹ãƒˆ | âœ… | ãƒ¢ãƒ¼ãƒ€ãƒ«ã®ãƒªã‚¹ãƒˆ |
| ã‚¿ã‚° | ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Š | âœ… | ãƒãƒƒã‚¸è¡¨ç¤º |
| ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«å | public/images/é…ä¸‹ | âœ… | ã‚«ãƒ¼ãƒ‰ + ãƒ¢ãƒ¼ãƒ€ãƒ« |
| æ‰€è¦æ™‚é–“(åˆ†) | å„ä½“é¨“ã®æ™‚é–“ | âœ… | ãƒ¢ãƒ¼ãƒ€ãƒ« |
| è¡¨ç¤ºé † | æ•°å­—ï¼ˆå°ã•ã„é †ï¼‰ | âœ… | ã‚«ãƒ¼ãƒ‰ã®ä¸¦ã³é † |
| æœ‰åŠ¹ | TRUE/FALSE | âœ… | FALSEã§éè¡¨ç¤º |

---

## åæ˜ ã‚¿ã‚¤ãƒŸãƒ³ã‚°

| æ“ä½œ | åæ˜ ã¾ã§ã®æ™‚é–“ |
|------|---------------|
| ã‚·ãƒ¼ãƒˆç·¨é›† | æœ€å¤§1æ™‚é–“ï¼ˆrevalidate: 3600ï¼‰ |
| Vercelãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§æ‰‹å‹•revalidate | å³æ™‚ |
| /api/revalidate?secret=xxx ã‚’å©ã | å³æ™‚ï¼ˆä¸‹è¨˜å‚ç…§ï¼‰ |

### ï¼ˆä»»æ„ï¼‰å³æ™‚åæ˜ ç”¨ã®Revalidate API

```typescript
// app/api/revalidate/route.ts
import { revalidatePath } from 'next/cache';

export async function GET(req: Request) {
  const { searchParams } = new URL(req.url);
  if (searchParams.get('secret') !== process.env.REVALIDATE_SECRET) {
    return Response.json({ error: 'Invalid secret' }, { status: 401 });
  }
  revalidatePath('/');        // LPã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢
  revalidatePath('/booking'); // äºˆç´„ãƒšãƒ¼ã‚¸ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚‚ã‚¯ãƒªã‚¢
  return Response.json({ revalidated: true });
}
```

ã‚·ãƒ¼ãƒˆç·¨é›†å¾Œã«å³åæ˜ ã—ãŸã„å ´åˆï¼š
```
https://your-domain.vercel.app/api/revalidate?secret=your-secret
```
ã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ãã ã‘ã€‚GASã®ãƒœã‚¿ãƒ³ã‹ã‚‰è‡ªå‹•ã§å©ãã“ã¨ã‚‚å¯èƒ½ã€‚

---

## å‹•ä½œç¢ºèªãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] LPã®ä½“é¨“ã‚«ãƒ¼ãƒ‰9ã¤ãŒã‚·ãƒ¼ãƒˆã®ãƒ‡ãƒ¼ã‚¿ã§è¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ä½“é¨“è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ«ã®èª¬æ˜æ–‡ãƒ»å†…å®¹ãƒªã‚¹ãƒˆãƒ»ã‚¿ã‚°ãŒã‚·ãƒ¼ãƒˆã®ãƒ‡ãƒ¼ã‚¿ã§è¡¨ç¤ºã•ã‚Œã‚‹
- [ ] äºˆç´„ãƒ•ã‚©ãƒ¼ãƒ Step 3ã®ä½“é¨“é¸æŠãŒã‚·ãƒ¼ãƒˆã®ãƒ‡ãƒ¼ã‚¿ã§è¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ã‚·ãƒ¼ãƒˆã§ä½“é¨“åã‚’å¤‰æ›´ â†’ 1æ™‚é–“ä»¥å†…ã«LPã«åæ˜ ã•ã‚Œã‚‹ï¼ˆor revalidateã§å³æ™‚åæ˜ ï¼‰
- [ ] ã‚·ãƒ¼ãƒˆã§ã€Œæœ‰åŠ¹ã€ã‚’FALSEã« â†’ LPã‹ã‚‰éè¡¨ç¤ºã«ãªã‚‹
- [ ] ã‚·ãƒ¼ãƒˆã§è¡¨ç¤ºé †ã‚’å¤‰æ›´ â†’ LPã®ä¸¦ã³é †ãŒå¤‰ã‚ã‚‹
- [ ] ã‚·ãƒ¼ãƒˆã«æ–°ã—ã„è¡Œã‚’è¿½åŠ  â†’ LPã«æ–°ã—ã„ä½“é¨“ã‚«ãƒ¼ãƒ‰ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] GASéšœå®³æ™‚ â†’ ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã§è¡¨ç¤ºã•ã‚Œã‚‹ï¼ˆã‚¨ãƒ©ãƒ¼ã«ãªã‚‰ãªã„ï¼‰
