# å®Ÿè£…æŒ‡ç¤º: äºˆç´„æ©Ÿèƒ½ + ç©ºãçŠ¶æ³ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ + GASé€£æº

## å‰æ
- LPï¼ˆãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ï¼‰ã®UIéƒ¨åˆ†ã¯å®Ÿè£…æ¸ˆã¿
- ã“ã‚Œã‹ã‚‰å®Ÿè£…ã™ã‚‹ã®ã¯ **äºˆç´„ãƒ•ã‚©ãƒ¼ãƒ æ©Ÿèƒ½** ã¨ **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆGASé€£æºï¼‰**
- Googleãƒ•ã‚©ãƒ¼ãƒ ã¯ä½¿ã‚ãªã„ã€‚ã‚«ã‚¹ã‚¿ãƒ UIã§å…¨ã¦å®Œçµã•ã›ã‚‹

---

## å…¨ä½“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
[ãƒ¦ãƒ¼ã‚¶ãƒ¼]
   â†“  LPé–²è¦§ + äºˆç´„æ“ä½œ
[Next.js (Vercel)]
   â”œâ”€â”€ / .................. LPï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰+ ç©ºãçŠ¶æ³ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ï¼ˆâ˜…æ–°è¦ï¼‰
   â”œâ”€â”€ /booking ........... äºˆç´„ãƒ•ã‚©ãƒ¼ãƒ ï¼ˆâ˜…æ–°è¦: 5ã‚¹ãƒ†ãƒƒãƒ—ï¼‰
   â”œâ”€â”€ /thanks ............ å®Œäº†ç”»é¢ï¼ˆâ˜…æ–°è¦ï¼‰
   â”œâ”€â”€ /api/availability .. GET: ç©ºãçŠ¶æ³å–å¾—ï¼ˆâ˜…æ–°è¦ï¼‰
   â””â”€â”€ /api/booking ....... POST: äºˆç´„é€ä¿¡ï¼ˆâ˜…æ–°è¦ï¼‰
         â†“
[GAS WebApp]
   â”œâ”€â”€ doGet .............. ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç®¡ç†ã‚·ãƒ¼ãƒˆèª­å– â†’ JSONè¿”å´
   â””â”€â”€ doPost ............. äºˆç´„ç®¡ç†ã‚·ãƒ¼ãƒˆæ›¸è¾¼ + ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«æ›´æ–° + Gmailé€ä¿¡
         â†“
[Googleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆ]  â†’  [Gmailè‡ªå‹•é€ä¿¡]
```

å…¨ã¦ç„¡æ–™ã€‚è¿½åŠ ã®å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ä¸è¦ã€‚

---

## â˜… å®Ÿè£…1: ç©ºãçŠ¶æ³ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ï¼ˆLPã«è¿½åŠ ï¼‰

æ—¢å­˜ã®LPãƒšãƒ¼ã‚¸ã« `AvailabilityCalendar` ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’è¿½åŠ ã™ã‚‹ã€‚
Pricingã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ä¸‹ã€FAQã®ä¸Šã‚ãŸã‚Šã«é…ç½®ã€‚

### ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ: `components/AvailabilityCalendar.tsx`

```tsx
'use client';
import { useEffect, useState } from 'react';

type SlotStatus = 'available' | 'booked' | 'closed';
type DaySlots = { [time: string]: SlotStatus };
type MonthData = { [date: string]: DaySlots };

export default function AvailabilityCalendar() {
  const [month, setMonth] = useState(() => {
    const now = new Date();
    return `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}`;
  });
  const [data, setData] = useState<MonthData>({});
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    setLoading(true);
    fetch(`/api/availability?month=${month}`)
      .then(r => r.json())
      .then(d => setData(d.days || {}))
      .catch(() => setData({}))  // ã‚¨ãƒ©ãƒ¼æ™‚ã¯ç©º â†’ å…¨æ availableæ‰±ã„
      .finally(() => setLoading(false));
  }, [month]);

  // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚°ãƒªãƒƒãƒ‰æç”»
  // å„æ—¥ä»˜ã‚»ãƒ«ã«4æ ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ãƒ‰ãƒƒãƒˆè¡¨ç¤º:
  //   â— ç·‘ = available
  //   â— ã‚°ãƒ¬ãƒ¼ = booked or closed
  // å…¨æ availableä»¥å¤–ãŒã‚ã‚‹æ—¥ã¯ã‚¿ãƒƒãƒ—ã§ /booking?date=2026-03-07 ã¸é·ç§»
  // å…¨æ booked/closedã®æ—¥ã¯ã‚°ãƒ¬ãƒ¼ã‚¢ã‚¦ãƒˆ + ã‚¿ãƒƒãƒ—ä¸å¯
}
```

### è¡¨ç¤ºä»•æ§˜

| ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚·ãƒ¼ãƒˆã®å€¤ | APIå€¤ | ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼è¡¨ç¤º | ã‚¿ãƒƒãƒ— |
|---|---|---|---|
| `â—` or ç©º | `available` | ç·‘ãƒ‰ãƒƒãƒˆ `â—` | `/booking?date=YYYY-MM-DD` ã¸é·ç§» |
| `BK-xxx` | `booked` | ã‚°ãƒ¬ãƒ¼ãƒ‰ãƒƒãƒˆ `â—` | å…¨æ bookedãªã‚‰ä¸å¯ |
| `âœ•` | `closed` | ã‚°ãƒ¬ãƒ¼ + ã€Œä¼‘ã€ | ä¸å¯ |
| APIå¤±æ•— | â€” | å…¨æ ç·‘ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰| å¯ï¼ˆGASå´ã§ãƒ€ãƒ–ãƒ«ãƒ–ãƒƒã‚­ãƒ³ã‚°é˜²æ­¢ã‚ã‚Šï¼‰ |

---

## â˜… å®Ÿè£…2: äºˆç´„ãƒ•ã‚©ãƒ¼ãƒ  `/booking`

ãƒ¯ã‚¤ãƒ¤ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ ï¼ˆwireframe_v3.htmlï¼‰ã® SCREEN 2ã€œ3 ã«å¯¾å¿œã€‚
1ãƒšãƒ¼ã‚¸å†…ã§5ã‚¹ãƒ†ãƒƒãƒ—ã‚’stateç®¡ç†ã™ã‚‹ã€‚ãƒšãƒ¼ã‚¸é·ç§»ã—ãªã„ã€‚

### ã‚¹ãƒ†ãƒƒãƒ—æ§‹æˆ

```
Step 1: æ—¥ä»˜é¸æŠï¼ˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ + ç©ºãçŠ¶æ³è¡¨ç¤ºï¼‰
Step 2: æ™‚é–“å¸¯é¸æŠï¼ˆ4æ : 16:00 / 18:00 / 20:00 / 22:00ï¼‰
Step 3: ä½“é¨“ãƒ¡ãƒ‹ãƒ¥ãƒ¼3ã¤é¸æŠï¼ˆ9ã¤ã®ã‚«ãƒ¼ãƒ‰ã‹ã‚‰ï¼‰
Step 4: ãŠå®¢æ§˜æƒ…å ±å…¥åŠ›ï¼ˆåå‰ãƒ»ãƒ¡ãƒ¼ãƒ«ãƒ»äººæ•°ãƒ»éƒ¨å±‹ç•ªå·ãƒ»è¦æœ›ï¼‰
Step 5: ç¢ºèªç”»é¢ + åˆ©ç”¨è¦ç´„åŒæ„ + é€ä¿¡
```

### çŠ¶æ…‹ç®¡ç†

```tsx
type BookingState = {
  currentStep: 1 | 2 | 3 | 4 | 5;
  date: string | null;            // "2026-03-07"
  timeSlot: string | null;        // "20:00-21:30"
  activities: string[];           // ["tate", "costume", "tea"]
  guestName: string;
  email: string;
  numberOfGuests: number | null;
  roomNumber: string;
  specialRequests: string;
  agreedToTerms: boolean;
  isSubmitting: boolean;
  error: string | null;
};
```

### ã‚¹ãƒ†ãƒƒãƒ—é·ç§»ãƒ«ãƒ¼ãƒ«

| æ“ä½œ | å‹•ä½œ |
|------|------|
| Step 1: æ—¥ä»˜ã‚¿ãƒƒãƒ— | â†’ è‡ªå‹•ã§Step 2ã¸ã€‚é¸æŠæ—¥ã®ç©ºãæ ã‚’fetch |
| Step 2: æ™‚é–“æ ã‚¿ãƒƒãƒ— | â†’ è‡ªå‹•ã§Step 3ã¸ã€‚æº€å¸­æ ã¯ã‚°ãƒ¬ãƒ¼ã‚¢ã‚¦ãƒˆ+é¸æŠä¸å¯ |
| Step 3:ã€Œæ¬¡ã¸ã€ãƒœã‚¿ãƒ³ | â†’ Step 4ã€‚activities.length === 3 ã®æ™‚ã®ã¿æœ‰åŠ¹ |
| Step 4:ã€Œæ¬¡ã¸ã€ãƒœã‚¿ãƒ³ | â†’ Step 5ã€‚å¿…é ˆé …ç›®ãŒå…¨ã¦å…¥åŠ›æ¸ˆã¿ã®æ™‚ã®ã¿æœ‰åŠ¹ |
| Step 5:ã€Œé€ä¿¡ã€ãƒœã‚¿ãƒ³ | â†’ POST /api/booking â†’ æˆåŠŸã§ /thanks ã¸ã€‚agreedToTermså¿…é ˆ |

### æˆ»ã‚‹æ“ä½œ

| æ“ä½œ | å‹•ä½œ |
|------|------|
| å„Stepã®ã€Œâ† æˆ»ã‚‹ã€ | å‰Stepã¸ã€‚å…¥åŠ›å†…å®¹ã¯å…¨ã¦ä¿æŒï¼ˆãƒªã‚»ãƒƒãƒˆã—ãªã„ï¼‰ |
| Step 5ã®ã€Œå¤‰æ›´ã€ãƒªãƒ³ã‚¯ | è©²å½“Stepã¸ã‚¸ãƒ£ãƒ³ãƒ—ï¼ˆæ—¥ä»˜â†’Step1, æ™‚é–“â†’Step2, ä½“é¨“â†’Step3ï¼‰ |
| Headerã€Œâœ• é–‰ã˜ã‚‹ã€ | ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã€Œäºˆç´„ã‚’ä¸­æ–­ã—ã¾ã™ã‹ï¼Ÿã€â†’ OKã§ `/` ã¸ |

### ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å¯¾å¿œ

```
/booking                    â†’ Step 1ã‹ã‚‰é–‹å§‹
/booking?date=2026-03-07    â†’ æ—¥ä»˜ã‚’äº‹å‰ã‚»ãƒƒãƒˆã€Step 2ã‹ã‚‰é–‹å§‹
/booking?preselect=tate     â†’ Step 3ã§è©²å½“ä½“é¨“ã‚’é¸æŠæ¸ˆã¿çŠ¶æ…‹ã«
```

LPå´ã®ç©ºãçŠ¶æ³ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‹ã‚‰æ—¥ä»˜ã‚’æ¸¡ã™å ´åˆã¨ã€
ä½“é¨“è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ«ã®ã€Œã“ã®ä½“é¨“ã‚’å«ã‚ã¦äºˆç´„ã™ã‚‹ã€ã‹ã‚‰ä½“é¨“IDã‚’æ¸¡ã™å ´åˆã«å¯¾å¿œã€‚

### Stepåˆ‡æ›¿æ™‚ã®UI

- ä¸Šéƒ¨ã«ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ï¼ˆ5æ®µéš: èµ¤=å®Œäº†/ã‚¢ã‚¯ãƒ†ã‚£ãƒ–, ã‚°ãƒ¬ãƒ¼=æœªåˆ°é”ï¼‰
- Stepåˆ‡æ›¿æ™‚ã¯ `window.scrollTo(0, 0)` ã§ãƒˆãƒƒãƒ—ã¸
- ã‚¹ãƒ†ãƒƒãƒ—ç•ªå· + ã‚¿ã‚¤ãƒˆãƒ«ã‚’è¡¨ç¤ºï¼ˆä¾‹: ã€ŒStep 1 / 5 â€” æ—¥ç¨‹ã‚’é¸æŠã€ï¼‰

### é€ä¿¡ãƒ•ãƒ­ãƒ¼

```
1. ã€Œäºˆç´„ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹ã€ã‚¿ãƒƒãƒ—
2. ãƒœã‚¿ãƒ³ â†’ ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ï¼ˆã‚¹ãƒ”ãƒŠãƒ¼ + ã€Œé€ä¿¡ä¸­â€¦ã€+ disabledï¼‰
3. POST /api/booking
4a. æˆåŠŸ â†’ /thanks?id=BK-xxx ã¸ router.push
4b. slot_taken â†’ ã€Œã“ã®æ ã¯åŸ‹ã¾ã‚Šã¾ã—ãŸã€‚æ—¥æ™‚ã‚’å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚ã€+ Step 2ã«æˆ»ã™
4c. ãã®ä»–ã‚¨ãƒ©ãƒ¼ â†’ èµ¤è‰²ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ + ãƒœã‚¿ãƒ³ãƒªã‚»ãƒƒãƒˆ
4d. ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ(15ç§’) â†’ ã€Œé€šä¿¡ã‚¨ãƒ©ãƒ¼ã€‚å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚ã€
5. /thanks é·ç§»å¾Œã€ãƒ–ãƒ©ã‚¦ã‚¶ãƒãƒƒã‚¯ã§ /booking ã«æˆ»ã‚Œãªã„ã‚ˆã† router.replace ä½¿ç”¨
```

---

## â˜… å®Ÿè£…3: å®Œäº†ãƒšãƒ¼ã‚¸ `/thanks`

ãƒ¯ã‚¤ãƒ¤ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ ã® SCREEN 4 ã«å¯¾å¿œã€‚

### è¡¨ç¤ºå†…å®¹

- ã€Œäºˆç´„ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ã‘ä»˜ã‘ã¾ã—ãŸã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
- ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³è¡¨ç¤º:
  1. âœ… ãƒªã‚¯ã‚¨ã‚¹ãƒˆå—ä»˜ï¼ˆå®Œäº†ï¼‰
  2. â³ é‹å–¶ãŒç¢ºèªä¸­
  3. ğŸ“§ 24æ™‚é–“ä»¥å†…ã«ç¢ºèªãƒ¡ãƒ¼ãƒ«é€ä»˜
  4. ğŸ‰ ä½“é¨“å½“æ—¥
- ãƒªã‚¯ã‚¨ã‚¹ãƒˆå†…å®¹ã‚µãƒãƒªãƒ¼ï¼ˆæ—¥ä»˜ãƒ»æ™‚é–“ãƒ»ä½“é¨“3ã¤ãƒ»äººæ•°ãƒ»æ–™é‡‘ï¼‰
- æ³¨æ„æ›¸ã:ã€Œ24æ™‚é–“ä»¥å†…ã«ç¢ºèªãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã—ã¾ã™ã€
- ã€Œã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«ä»®ç™»éŒ²ã€ãƒœã‚¿ãƒ³ â†’ .icsãƒ•ã‚¡ã‚¤ãƒ«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
- ã€ŒLPã«æˆ»ã‚‹ã€ãƒœã‚¿ãƒ³ â†’ `/` ã¸

### .icsãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆ

```typescript
function generateICS(booking: BookingData): string {
  const start = `${booking.date.replace(/-/g, '')}T${booking.timeSlot.split('-')[0].replace(':', '')}00`;
  const end = `${booking.date.replace(/-/g, '')}T${booking.timeSlot.split('-')[1].replace(':', '')}00`;
  return [
    'BEGIN:VCALENDAR',
    'VERSION:2.0',
    'BEGIN:VEVENT',
    `DTSTART:${start}`,
    `DTEND:${end}`,
    `SUMMARY:Shidenryu Experience (Tentative)`,
    `DESCRIPTION:Activities: ${booking.activities.join(', ')}`,
    'STATUS:TENTATIVE',
    'END:VEVENT',
    'END:VCALENDAR'
  ].join('\r\n');
}
```

---

## â˜… å®Ÿè£…4: APIãƒ«ãƒ¼ãƒˆ

### `app/api/availability/route.ts`

```typescript
export async function GET(req: Request) {
  const { searchParams } = new URL(req.url);
  const month = searchParams.get('month');

  if (!month || !/^\d{4}-\d{2}$/.test(month)) {
    return Response.json({ error: 'Invalid month format' }, { status: 400 });
  }

  try {
    const gasUrl = `${process.env.GAS_WEBAPP_URL}?action=getAvailability&month=${month}`;
    const res = await fetch(gasUrl, { next: { revalidate: 300 } }); // 5åˆ†ã‚­ãƒ£ãƒƒã‚·ãƒ¥
    const data = await res.json();
    return Response.json(data);
  } catch {
    return Response.json({ month, days: {} }); // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
  }
}
```

### `app/api/booking/route.ts`

```typescript
export async function POST(req: Request) {
  const body = await req.json();

  // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
  if (!body.date || !body.timeSlot) {
    return Response.json({ success: false, error: 'missing_fields' }, { status: 400 });
  }
  if (!Array.isArray(body.activities) || body.activities.length !== 3) {
    return Response.json({ success: false, error: 'need_3_activities' }, { status: 400 });
  }
  const validSlots = ['16:00-17:30', '18:00-19:30', '20:00-21:30', '22:00-23:30'];
  if (!validSlots.includes(body.timeSlot)) {
    return Response.json({ success: false, error: 'invalid_slot' }, { status: 400 });
  }
  if (!body.numberOfGuests || body.numberOfGuests < 1 || body.numberOfGuests > 4) {
    return Response.json({ success: false, error: 'invalid_guests' }, { status: 400 });
  }
  if (!body.agreedToTerms) {
    return Response.json({ success: false, error: 'terms_required' }, { status: 400 });
  }
  if (!body.email || !/\S+@\S+\.\S+/.test(body.email)) {
    return Response.json({ success: false, error: 'invalid_email' }, { status: 400 });
  }

  // GAS WebApp ã¸è»¢é€
  try {
    const gasRes = await fetch(process.env.GAS_WEBAPP_URL!, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        action: 'createBooking',
        apiKey: process.env.GAS_API_KEY,
        data: body,
      }),
    });
    const result = await gasRes.json();
    if (!result.success) {
      return Response.json(result, { status: 409 }); // slot_takenç­‰
    }
    return Response.json(result);
  } catch {
    return Response.json(
      { success: false, error: 'server_error', message: 'Failed to process booking.' },
      { status: 500 }
    );
  }
}
```

---

## â˜… ç’°å¢ƒå¤‰æ•°

```env
# .env.local
GAS_WEBAPP_URL=https://script.google.com/macros/s/xxxxx/exec
GAS_API_KEY=sk-xxxxxxxx
```

`GAS_WEBAPP_URL` ã¯ `NEXT_PUBLIC_` ãªã—ï¼ˆã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã®ã¿ã§ä½¿ç”¨ã€‚ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«æ¼ã‚Œãªã„ï¼‰ã€‚

---

## è¿½åŠ ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§

```
app/
â”œâ”€â”€ booking/
â”‚   â””â”€â”€ page.tsx            â˜… äºˆç´„ãƒ•ã‚©ãƒ¼ãƒ ï¼ˆ5ã‚¹ãƒ†ãƒƒãƒ—ï¼‰
â”œâ”€â”€ thanks/
â”‚   â””â”€â”€ page.tsx            â˜… å®Œäº†ç”»é¢
â””â”€â”€ api/
    â”œâ”€â”€ availability/
    â”‚   â””â”€â”€ route.ts        â˜… GET: ç©ºãçŠ¶æ³
    â””â”€â”€ booking/
        â””â”€â”€ route.ts        â˜… POST: äºˆç´„é€ä¿¡

components/
â”œâ”€â”€ AvailabilityCalendar.tsx  â˜… LPç”¨ ç©ºãçŠ¶æ³ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼
â”œâ”€â”€ booking/
â”‚   â”œâ”€â”€ StepCalendar.tsx      â˜… Step 1: æ—¥ä»˜é¸æŠ
â”‚   â”œâ”€â”€ StepTimeSlots.tsx     â˜… Step 2: æ™‚é–“å¸¯é¸æŠ
â”‚   â”œâ”€â”€ StepActivities.tsx    â˜… Step 3: ä½“é¨“3ã¤é¸æŠ
â”‚   â”œâ”€â”€ StepGuestInfo.tsx     â˜… Step 4: æƒ…å ±å…¥åŠ›
â”‚   â”œâ”€â”€ StepConfirm.tsx       â˜… Step 5: ç¢ºèª+é€ä¿¡
â”‚   â””â”€â”€ ProgressBar.tsx       â˜… ã‚¹ãƒ†ãƒƒãƒ—é€²æ—ãƒãƒ¼
â””â”€â”€ (æ—¢å­˜ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ãã®ã¾ã¾)

lib/
â”œâ”€â”€ services.ts              ï¼ˆæ—¢å­˜: 9ä½“é¨“ãƒ‡ãƒ¼ã‚¿ï¼‰
â”œâ”€â”€ availability.ts          â˜… ç©ºãçŠ¶æ³fetché–¢æ•°
â””â”€â”€ booking.ts               â˜… äºˆç´„é€ä¿¡é–¢æ•° + å‹å®šç¾©
```

---

## ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ä¸€è¦§

| å ´æ‰€ | ãƒã‚§ãƒƒã‚¯å†…å®¹ | å¤±æ•—æ™‚ |
|------|-------------|--------|
| Step 1 | éå»ã®æ—¥ä»˜ã¯é¸æŠä¸å¯ | ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã§ã‚°ãƒ¬ãƒ¼ã‚¢ã‚¦ãƒˆ |
| Step 2 | booked/closedã®æ ã¯é¸æŠä¸å¯ | ã‚°ãƒ¬ãƒ¼ã‚¢ã‚¦ãƒˆ + ã€Œâœ• æº€å¸­ã€è¡¨ç¤º |
| Step 3 | activities.length === 3 | ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã€Œ2/3ã€+ ãƒœã‚¿ãƒ³disabled |
| Step 3 | åŒã˜ä½“é¨“ã®é‡è¤‡é¸æŠä¸å¯ | é¸æŠæ¸ˆã¿ã‚«ãƒ¼ãƒ‰ã¯å†ã‚¿ãƒƒãƒ—ã§è§£é™¤ |
| Step 4 | åå‰ãƒ»ãƒ¡ãƒ¼ãƒ«ãƒ»äººæ•°ãƒ»éƒ¨å±‹ç•ªå·ãŒå¿…é ˆ | æœªå…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«èµ¤æ  |
| Step 4 | ãƒ¡ãƒ¼ãƒ«å½¢å¼ãƒã‚§ãƒƒã‚¯ | ã€Œæ­£ã—ã„ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€ |
| Step 4 | äººæ•° 1ã€œ4 | ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ã§åˆ¶é™ |
| Step 5 | agreedToTerms === true | é€ä¿¡ãƒœã‚¿ãƒ³disabled + ã‚°ãƒ¬ãƒ¼ã‚¢ã‚¦ãƒˆ |
| API | ä¸Šè¨˜å…¨ã¦ + æ ã®ç©ºããƒã‚§ãƒƒã‚¯ï¼ˆGASå´ï¼‰ | ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹è¿”å´ |

---

## GASå´ã®å®Ÿè£…

ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆè¨­è¨ˆæ›¸ï¼ˆå‰£èˆä¼šã‚¨ãƒƒã‚¸_ã‚·ãƒ¼ãƒˆè¨­è¨ˆ_final.xlsxï¼‰ã®ã€ŒGASé€£æºä»•æ§˜ã€ã‚·ãƒ¼ãƒˆã«
**doGet / doPost ã®å®Œå…¨ãªã‚³ãƒ¼ãƒ‰ã‚µãƒ³ãƒ—ãƒ«** ãŒè¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚
ãã®ã¾ã¾ GAS ã‚¨ãƒ‡ã‚£ã‚¿ã«ã‚³ãƒ”ãƒ¼ã—ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ãã ã•ã„ã€‚

### GASãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †ï¼ˆå‚è€ƒï¼‰
1. ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’ä½œæˆï¼ˆè¨­è¨ˆæ›¸ã®å„ã‚·ãƒ¼ãƒˆé€šã‚Šï¼‰
2. æ‹¡å¼µæ©Ÿèƒ½ â†’ Apps Script
3. ã€ŒGASé€£æºä»•æ§˜ã€ã‚·ãƒ¼ãƒˆã®ã‚³ãƒ¼ãƒ‰ã‚’è²¼ã‚Šä»˜ã‘
4. ãƒ‡ãƒ—ãƒ­ã‚¤ â†’ ã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒª â†’ ã‚¢ã‚¯ã‚»ã‚¹: å…¨å“¡
5. ãƒ‡ãƒ—ãƒ­ã‚¤URLã‚’ `.env.local` ã® `GAS_WEBAPP_URL` ã«è¨­å®š

---

## å®Ÿè£…é †åº

```
1. lib/availability.ts + lib/booking.tsï¼ˆå‹å®šç¾© + fetché–¢æ•°ï¼‰
2. app/api/availability/route.tsï¼ˆç©ºãçŠ¶æ³APIï¼‰
3. app/api/booking/route.tsï¼ˆäºˆç´„é€ä¿¡APIï¼‰
4. components/AvailabilityCalendar.tsx â†’ LPã«çµ„ã¿è¾¼ã¿
5. components/booking/ é…ä¸‹ã®å„Stepã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
6. app/booking/page.tsxï¼ˆ5ã‚¹ãƒ†ãƒƒãƒ—ã®çµ±åˆï¼‰
7. app/thanks/page.tsxï¼ˆå®Œäº†ç”»é¢ï¼‰
8. å…¨ä½“çµåˆãƒ†ã‚¹ãƒˆ
```

## Cursor AIã¸ã®æŒ‡ç¤º

> `å®Ÿè£…æŒ‡ç¤º.md` ã‚’èª­ã‚“ã§ã€å®Ÿè£…é †åºã®é€šã‚Šã«é€²ã‚ã¦ãã ã•ã„ã€‚
> LPã®UIéƒ¨åˆ†ã¯å®Ÿè£…æ¸ˆã¿ãªã®ã§è§¦ã‚‰ãªã„ã§ãã ã•ã„ã€‚
> ã¾ãš lib/ ã®å‹å®šç¾©ã¨fetché–¢æ•°ã‹ã‚‰å§‹ã‚ã¦ã€
> æ¬¡ã«APIãƒ«ãƒ¼ãƒˆ2ã¤ã€ãã®å¾Œã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œã£ã¦ãã ã•ã„ã€‚
> ãƒ‡ã‚¶ã‚¤ãƒ³ã¯ wireframe_v3.html ã®SCREEN 2ã€œ4ã‚’å‚è€ƒã«ã—ã¦ãã ã•ã„ã€‚
